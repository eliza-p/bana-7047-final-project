---
title: "Data Wrangling & EDA"
output: html_notebook
<<<<<<< HEAD
<<<<<<< Updated upstream
=======
test 2
>>>>>>> Stashed changes
=======
test
>>>>>>> 0bb77ecb58fde5a7c63580246c50f719ab0e2af8

test 3
---
Background Information and Objective

The data set we are using for our project is called "The Complete Journey 2.0" and it is found on the 84.51 website. This data set has transactions at the household level from a group of 5,000 households over a two year period. This is a relational data set comprised of household data, transaction data, and product data that can be combined by household and product IDs. The household data has demographic information such as the size, income, and age of the household. The transaction data contains information like the amount of money spent and the number of items in a transaction. The product data contains information like the product category, whether a product is organic, and whether the product is a private or national brand. 

For this project, we are acting as a team at 84.51 that is interested in identifying households and baskets that are likely to buy organic products so we know who to target for an organic product  marketing campaign. In order to do this, we will use data at both the household and basket level and try classification models to to accurately identify these households. We are also interested in organic trends over time and will use a classification model to attempt to flag households who have increased their spending on organic products in year two. 

```{r libraries warning=FALSE}
#load needed libraries
library(tidyverse)
```
```{r set_wd_load_data warning=FALSE}
#Setting wd and lodaing data
#put the path of where you are storing the data on your computer
paths=c('C:/Users/eliza/Documents/BANA 7047 - Data Mining II/Group Project/Data', 'path2', 'path3')
#use the code Sys.info()[7] to find out how yoru name is stored on your local machine, copy to this list
names(paths)=c('eliza', 'name2', 'name3')
#this will set the wd
setwd(paths[Sys.info()[7]])

#load data sets
households <- read_csv('5000_households.csv', col_types=cols(.default='f', HSHD_NUM='c'))
transactions <- read_csv('5000_transactions.csv', col_types=cols(.default='?', STORE_R='f', YEAR='f'))
products <- read_csv('5000_products.csv', col_types=cols(.default='f', PRODUCT_NUM='c'))

#rename column 'X5' to be more descriptive
products <- products %>% rename(ORGANIC = X5)

#rename truncated date and store region column on transactions
transactions <- transactions %>%
  rename(DATE=PURCHASE_) %>%
  rename(REGION = STORE_R)
```
```{r households_summary}
summary(households, maxsum=20)
```
```{r products_summary}
summary(products, maxsum = 30)
```
```{r transactions_summary}
summary(transactions)
```
```{r returns}
#I was curious how many transactions there are with negative spends - I think these might be returns & we may want to filter?
returns <- transactions %>% 
  filter(SPEND<0) %>%
  group_by(BASKET_NUM) %>%
  summarise(
    ITEMS = n(),
    TOTAL_RETURN = sum(SPEND),
    TOTAL_UNITS = sum(UNITS)
  )

summary(returns)
```
The Data

"The Complete Journey 2.0" is comprised of three relational data sets: households, transactions, and products. 

The households data set has 5000 observations and 9 variables. A summary of each variable is shown below. HSHD_NUM is the unique identifier that linkns this data set to the transactions data set. Other variables include the age range, marital status, income range, number of children, household composition, household size, homeowner status, and whether the household is loyal to kroger or not. There are 866 records in this data set that have null values. 

```{r hh summary, echo=TRUE}
summary(households, maxsum=20)
str(households)
```



```{r baskets}
#creating a data set with basket level detail - filter out negative spends
baskets <- transactions %>%
  filter(SPEND>0) %>%
  group_by(HSHD_NUM, BASKET_NUM) %>%
  summarise(
    PRODUCTS = n(),
    TOTAL_SPEND = sum(SPEND),
    TOTAL_UNITS = sum(UNITS)
  )

summary(baskets)
```
```{r key_check}
#confirming primary keys in each table are unique
households %>% 
  count(HSHD_NUM) %>% 
  filter(n > 1)

products %>%
  count(PRODUCT_NUM) %>% 
  filter(n > 1)

baskets %>%
  count(BASKET_NUM) %>% 
  filter(n > 1)
```
```{r merged_dataset}
merged_df <- transactions %>%
  filter(SPEND>0) 

merged_df <- left_join(merged_df, products, by='PRODUCT_NUM') 

merged_df <- left_join(merged_df, households, by='HSHD_NUM')

merged_df <- left_join(merged_df, baskets, by='BASKET_NUM')

#To save time in the future saving out dataset
save(merged_df, file='merged_df.Rdata')
```

```{r organic}
#sumarising the proportion of organic foods each household buys
organic <- merged_df %>%
  filter(DEPARTMENT=='FOOD')
  group_by(HSHD_NUM.x) %>%
  summarise(
    TOTAL_UNITS = sum(UNITS),
    ORGANIC = ifelse(ORGANIC=='Y', sum(UNITS),0)
  )

summary(organic)
```
```{r}
colnames(merged_df)
```

